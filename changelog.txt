# POK-Manager Changelog

## Version 2.1.60 (Latest)
### Bug Fixes
- Fixed docker-compose file path resolution by updating functions (read_docker_compose_config, write_docker_compose_file, generate_docker_compose, start_instance, stop_instance, etc.) to use BASE_DIR instead of the script's relative path. This ensures that the docker-compose YAML file is correctly located even if the manager is moved.

## Version 2.1.58 (Latest)
### Improvements
- Added a 30-second timeout to update prompts for better compatibility with cronjobs
- Improved non-interactive mode handling for automation scenarios
- Enhanced update check system to continue operation when running in background

## [2.1.57] - Previous

### Changed
- Added automatic detection of volume path changes when POK-Manager is moved to a new directory.
- Implemented interactive prompt to update volume paths in docker-compose files.
- Added configuration option to remember user's path update preference.
- Improved container identification using container IDs and names instead of just folder names.
- Enhanced start_instance and stop_instance functions to use more robust container identification.
- Fixed potential issues with container operations when using non-standard naming.

## [2.1.56] - Previous

### Fixed
- Fixed issue where running commands with sudo would change POK-manager.sh ownership to root.
- Added automatic permission detection with interactive fix prompt at script startup.
- Enhanced `-fix` command to properly restore script ownership when run with sudo.
- Improved upgrade process to maintain correct script ownership across updates.
- Added specific handling for POK-manager.sh file in all permission-related functions.
- Fixed issue with backup command changing file ownership in sudo mode.
- Improved permission handling for all operations that might require elevated privileges.
- Added proactive permission checks to prevent common "Operation not permitted" errors.
- Enhanced user guidance when permission issues are detected.
- Implemented smarter ownership detection based on SUDO_USER or system configuration.

## [2.1.55] - Previous

### Changed
- Fixed permission issues with the backup system when using the `-backup` command.
- Added fallback mechanism to handle `/config/POK-manager/` permission denied errors.
- Enhanced backup configuration to use default values (10 backups, 10GB max) when no config exists.
- Ensured backup process doesn't stop running servers during backup operations.

## [2.1.53] - Previous

### Changed
- Added command persistence when upgrading the POK-Manager script.
- Automatically saved and reused commands when restarting after an update to avoid retyping long server chat messages.
- Improved user experience by preserving command history across restarts.
- Added rollback support for saved commands to ensure they're never lost.

## [2.1.52] - Previous

### Fixed
- Fixed issue with the `-update` command failing to find containers with "asa_" prefix.
- Improved container name handling to support both prefixed and non-prefixed container names.
- Removed duplicate code in the update function that could cause errors.
- Enhanced update process to correctly identify running containers regardless of naming convention.

## [2.1.51] - Previous

### Changed
- Added disk space management to prevent containers from consuming excessive storage.
- Implemented automatic log rotation to limit storage consumption.
- Cleaned up temporary files during container lifecycle events (start, stop, restart).
- Removed unnecessary data persistence between container restarts.
- Fixed issue where restarting containers could consume all available space.

## [2.1.50] - Previous

### Changed
- Switched to new user ID system (UID 7777) for improved permission handling.
- Integrated AsaApi (ARK Server API) for plugin support.
- Updated Docker image to `acekorneya/asa_server:2_1_latest` (replacing `2_0_latest`).
- Enhanced backup and restore functionality with rotation policies.
- Added migration tools for upgrading from 2.0 to 2.1.

#### New Commands
- `-API <TRUE|FALSE> <instance_name|-all>`: Enable or disable ArkServerAPI for specified instance(s).
- `-beta`: Switch to beta mode to use beta Docker images for testing new features.
- `-stable`: Switch to stable mode to use stable Docker images.
- `-migrate`: Migrate from 2.0 to 2.1 with permission adjustments.
- `-changelog`: Display the changelog.
- `-api-recovery`: Recover API instances with container restart.

#### File System & Permissions
- Changed default UID/GID from 1000:1000 to 7777:7777.
- Introduced a migration system to handle permission upgrades.
- Improved file ownership checks and automatic corrections.
- Enhanced permission handling for cluster directories.

### Backup System Improvements
- Added automated backup rotation based on count and size limits
- Configurable backup policies per instance
- Improved backup operations with better error handling
- Enhanced restoration process with clearer user guidance

### Server Management
- Enhanced server shutdown and restart processes
- Added support for AsaApi plugins and mods
- Improved server initialization and startup
- Better handling of server crashes and recovery
- Added option for random startup delays to prevent update conflicts

### User Interface
- Added colorful ASCII logo and improved visual formatting
- Enhanced status messages and error reporting
- Better progress indicators for long-running operations
- More detailed server status information

### Docker Improvements
- Added support for both 2.0 and 2.1 Docker images
- Improved container environment setup
- Enhanced Wine/Proton configuration for better performance
- Added container health checks and recovery mechanisms

### Documentation
- Added extensive in-script documentation
- Improved error messages with troubleshooting guidance
- Added version information display

## [2.0] - Previous
- Initial stable release of POK-Manager
- Basic Docker containerization
- Server management commands
- Permission handling with UID/GID 1000:1000
- Simple backup functionality
- Basic server startup and shutdown

Note: To update from version 2.0 to 2.1, run: `./POK-manager.sh -migrate`
This will adjust file permissions and update Docker images to ensure compatibility. 