# POK-Manager Changelog

## Version 2.1.65 (Latest)
### Bug Fixes
- Fixed issues with `-status`, `-saveworld`, and `-chat` commands when used with `-all` parameter
- Corrected behavior so `-status -all` properly displays detailed server information for all instances
- Fixed `-saveworld -all` to save all server worlds without prompting for instance selection
- Improved `-chat` command handling when used with `-all` to send messages to all instances
- Enhanced consistency of command behavior between single instance and all instances
- Standardized output formatting for all-instance operations

## Version 2.1.64 (Previous)
### New Features
- Added feature to display patch notes when the program updates to a new version
- Automatically shows relevant changes when the script is updated
- Stores the last displayed version to avoid showing the same patch notes multiple times
- Provides a user-friendly overview of what's changed since the last version used
- Enhanced `-version` command to display patch notes for the current version
- Added ability to view version-specific changes directly when checking version information

### Improvements
- Enhanced Docker Compose file handling to be more robust when users move or rename instance folders
- Added dynamic docker-compose file discovery throughout the BASE_DIR, not just in expected locations
- Improved `list_instances` function to find all instances regardless of folder structure
- Added new `find_docker_compose_file` function that prioritizes expected paths but can locate moved files
- Enhanced error messages and interactive prompts when docker-compose files can't be found
- Added fallback mechanisms to stop containers directly if docker-compose files are missing
- Improved handling of -all variants (start, stop, restart, shutdown, status) to work with relocated instances
- Added user-friendly interactive selection when multiple potential docker-compose files are found
- Improved `-logs` command to automatically show a selection list when no instance is specified
- Enhanced log viewing to properly handle the `-live` flag and directly present instance choices
- Added better validation and error messages when viewing logs for non-existent or stopped instances
- Added automatic validation and correction of docker-compose files to ensure container names, instance names, and volume paths remain consistent even when files are moved or renamed

## Version 2.1.63 (Previous)
### Bug Fixes
- Fixed volume path updates during instance rename operations
- Updated `-rename -all` command to properly continue after restarting renamed containers
- Ensured docker_compose_cmd config file is correctly placed in the base config directory when renaming
- Improved path handling in docker-compose files when renaming instances
- Enhanced container restart process after renaming to maintain server state

## Version 2.1.62 (Previous)
### Bug Fixes
- Updated get_docker_compose_cmd() to verify that the docker_compose_cmd file is non-empty before reading its content.
- If the file is empty, the function now determines the correct Docker Compose command and writes it to the file.
- This fix resolves the '-f command not found' error encountered when starting an instance.
- Removed redundant update check that was causing the script to check for updates twice (once before displaying the logo and once when executing commands).

## Version 2.1.60 (Latest)
### Bug Fixes
- Fixed docker-compose file path resolution by updating functions (read_docker_compose_config, write_docker_compose_file, generate_docker_compose, start_instance, stop_instance, etc.) to use BASE_DIR instead of the script's relative path. This ensures that the docker-compose YAML file is correctly located even if the manager is moved.

## Version 2.1.58 (Latest)
### Improvements
- Added a 30-second timeout to update prompts for better compatibility with cronjobs
- Improved non-interactive mode handling for automation scenarios
- Enhanced update check system to continue operation when running in background

## [2.1.57] - Previous

### Changed
- Added automatic detection of volume path changes when POK-Manager is moved to a new directory.
- Implemented interactive prompt to update volume paths in docker-compose files.
- Added configuration option to remember user's path update preference.
- Improved container identification using container IDs and names instead of just folder names.
- Enhanced start_instance and stop_instance functions to use more robust container identification.
- Fixed potential issues with container operations when using non-standard naming.

## [2.1.56] - Previous

### Fixed
- Fixed issue where running commands with sudo would change POK-manager.sh ownership to root.
- Added automatic permission detection with interactive fix prompt at script startup.
- Enhanced `-fix` command to properly restore script ownership when run with sudo.
- Improved upgrade process to maintain correct script ownership across updates.
- Added specific handling for POK-manager.sh file in all permission-related functions.
- Fixed issue with backup command changing file ownership in sudo mode.
- Improved permission handling for all operations that might require elevated privileges.
- Added proactive permission checks to prevent common "Operation not permitted" errors.
- Enhanced user guidance when permission issues are detected.
- Implemented smarter ownership detection based on SUDO_USER or system configuration.

## [2.1.55] - Previous

### Changed
- Fixed permission issues with the backup system when using the `-backup` command.
- Added fallback mechanism to handle `/config/POK-manager/` permission denied errors.
- Enhanced backup configuration to use default values (10 backups, 10GB max) when no config exists.
- Ensured backup process doesn't stop running servers during backup operations.

## [2.1.53] - Previous

### Changed
- Added command persistence when upgrading the POK-Manager script.
- Automatically saved and reused commands when restarting after an update to avoid retyping long server chat messages.
- Improved user experience by preserving command history across restarts.
- Added rollback support for saved commands to ensure they're never lost.

## [2.1.52] - Previous

### Fixed
- Fixed issue with the `-update` command failing to find containers with "asa_" prefix.
- Improved container name handling to support both prefixed and non-prefixed container names.
- Removed duplicate code in the update function that could cause errors.
- Enhanced update process to correctly identify running containers regardless of naming convention.

## [2.1.51] - Previous

### Changed
- Added disk space management to prevent containers from consuming excessive storage.
- Implemented automatic log rotation to limit storage consumption.
- Cleaned up temporary files during container lifecycle events (start, stop, restart).
- Removed unnecessary data persistence between container restarts.
- Fixed issue where restarting containers could consume all available space.

## [2.1.50] - Previous

### Changed
- Switched to new user ID system (UID 7777) for improved permission handling.
- Integrated AsaApi (ARK Server API) for plugin support.
- Updated Docker image to `acekorneya/asa_server:2_1_latest` (replacing `2_0_latest`).
- Enhanced backup and restore functionality with rotation policies.
- Added migration tools for upgrading from 2.0 to 2.1.

#### New Commands
- `-API <TRUE|FALSE> <instance_name|-all>`: Enable or disable ArkServerAPI for specified instance(s).
- `-beta`: Switch to beta mode to use beta Docker images for testing new features.
- `-stable`: Switch to stable mode to use stable Docker images.
- `-migrate`: Migrate from 2.0 to 2.1 with permission adjustments.
- `-changelog`: Display the changelog.
- `-api-recovery`: Recover API instances with container restart.

#### File System & Permissions
- Changed default UID/GID from 1000:1000 to 7777:7777.
- Introduced a migration system to handle permission upgrades.
- Improved file ownership checks and automatic corrections.
- Enhanced permission handling for cluster directories.

### Backup System Improvements
- Added automated backup rotation based on count and size limits
- Configurable backup policies per instance
- Improved backup operations with better error handling
- Enhanced restoration process with clearer user guidance

### Server Management
- Enhanced server shutdown and restart processes
- Added support for AsaApi plugins and mods
- Improved server initialization and startup
- Better handling of server crashes and recovery
- Added option for random startup delays to prevent update conflicts

### User Interface
- Added colorful ASCII logo and improved visual formatting
- Enhanced status messages and error reporting
- Better progress indicators for long-running operations
- More detailed server status information

### Docker Improvements
- Added support for both 2.0 and 2.1 Docker images
- Improved container environment setup
- Enhanced Wine/Proton configuration for better performance
- Added container health checks and recovery mechanisms

### Documentation
- Added extensive in-script documentation
- Improved error messages with troubleshooting guidance
- Added version information display

## [2.0] - Previous
- Initial stable release of POK-Manager
- Basic Docker containerization
- Server management commands
- Permission handling with UID/GID 1000:1000
- Simple backup functionality
- Basic server startup and shutdown

Note: To update from version 2.0 to 2.1, run: `./POK-manager.sh -migrate`
This will adjust file permissions and update Docker images to ensure compatibility. 